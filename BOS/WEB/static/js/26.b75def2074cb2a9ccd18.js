webpackJsonp([26],{1124:function(t,e,a){"use strict";(function(t){var s=a(7);e.a={data:function(){return{Calculator:void 0,IsExcute:!1,DataSetting:{},objSetting:{},SumFields:[],MinFields:[],CountFields:[],AverageFields:[],ExpressionFields:[],calculatorRequest:[],rootData:[],Index:0,Increased:100,comboCalculator:[]}},mounted:function(){this.init()},methods:{Calculate:function(){var e=this,a=this,i=this.$Lodash.cloneDeep(this.$singleRequest);i.R1_RequestTemplate="Setting.SearchBase",i.R1_Code=a.Calculator,s.a.post(i).then(function(i){a.DataSetting=s.a.getDataWithRoot(i.R1,"Data.DynamicDS.Setting")[0],a.objSetting=s.a.stringToObject(e.$Lodash.cloneDeep(a.DataSetting.Description)),s.a.isEmpty(a.objSetting.Sum)&&(a.SumFields=s.a.stringToObject(a.objSetting.Sum.replaceAll("+","&").replaceAll(":","="))),s.a.isEmpty(a.objSetting.Count)&&(a.CountFields=s.a.stringToObject(a.objSetting.Count.replaceAll("+","&").replaceAll(":","="))),s.a.isEmpty(a.objSetting.Min)&&(a.MinFields=s.a.stringToObject(a.objSetting.Min.replaceAll("+","&").replaceAll(":","="))),s.a.isEmpty(a.objSetting.Max)&&(a.MaxFields=s.a.stringToObject(a.objSetting.Max.replaceAll("+","&").replaceAll(":","="))),s.a.isEmpty(a.objSetting.Average)&&(a.AverageFields=s.a.stringToObject(a.objSetting.Average.replaceAll("+","&").replaceAll(":","="))),s.a.isEmpty(a.objSetting.Expression)&&(a.ExpressionFields=s.a.stringToObject(a.objSetting.Expression.replaceAll("+","&").replaceAll(":","=")));var n=e.$Lodash.cloneDeep(e.$singleRequest);n.R1_RequestTemplate=a.objSetting.RRequestTemplate+".Search",n.R1_RequestDataGroup=a.objSetting.RRequestDataGroup,n.R1_RequestFields=a.objSetting.RRequestFields,n.R1_Code=a.objSetting.RCode,n.TotalRequests=1,s.a.showLoading("start"),s.a.post(n).then(function(i){a.rootData=s.a.getDataWithRoot(i.R1,a.objSetting.RDataSource),a.mathIndex=0,a.rootLength=a.rootData.length,0!=a.rootData.length?(a.calculatorRequest=[],t.each(a.rootData,function(t,a){e.createCalculatorRequest(a,t)})):(s.a.showLoading("stop"),s.a.showMessage("error","Không có dữ liệu!"))})})},createCalculatorRequest:function(e,a){var i=this,n=e;t.each(i.objSetting.RFields.split(";"),function(t,e){n[e]=0});var o=this.$Lodash.cloneDeep(this.$singleRequest);o.TotalRequests=0;for(var l=1;l<=i.objSetting.R;l++)o["R"+l+"_RequestTemplate"]=i.objSetting["R"+l+"RequestTemplate"]+".Search",o["R"+l+"_RequestDataGroup"]=i.objSetting["R"+l+"RequestDataGroup"],o["R"+l+"_RequestFields"]=i.objSetting["R"+l+"RequestFields"],o["R"+l+"_Code"]=i.objSetting["R"+l+"Code"],o.TotalRequests++,t.each(i.objSetting["R"+l+"RequestFields"].split(";"),function(t,e){s.a.isEmpty(i.objSetting["R"+l+e])&&"Code"!=e&&(o["R"+l+"_"+e]=n[i.objSetting["R"+l+e]])}),s.a.isEmpty(i.objSetting["R"+l+"SearchField"])&&!s.a.isEmpty(o["R"+l+"_"+i.objSetting["R"+l+"SearchField"]])&&(o["R"+l+"_"+i.objSetting["R"+l+"SearchField"]]=NaN);if(i.calculatorRequest.push(o),a==i.rootData.length-1){t.each(i.calculatorRequest,function(t,e){i.calculatorProcessing(e,i.rootData[t],t)})}},calculatorProcessing:function(e,a){var i=this,n=this;s.a.post(e).then(function(e){for(var o=1;o<=n.objSetting.R;o++)n["DataR"+o]=s.a.getDataWithRoot(e["R"+o],n.objSetting["R"+o+"DataSource"]),t.each(n["DataR"+o],function(e,i){t.each(n.SumFields,function(t,e){s.a.isEmpty(i[e])&&(a[t]=parseInt(a[t])+parseInt(i[e]))}),t.each(n.CountFields,function(e,l){if(l.indexOf("!!")>=0&&!s.a.isEmpty(c))var c="";s.a.isEmpty(n.objSetting["R"+o])&&t.each(n.objSetting["R"+o].split(";"),function(t,n){-1==l.indexOf("!!")&&s.a.isEmpty(i[l])&&n==e?a[e]=parseInt(a[e])+1:s.a.isEmpty(c)&&s.a.isEmpty(i[l.split("!!")[0]])&&n==e&&-1==c.indexOf(i[l.split("!!")[1]])&&(a[e]=parseInt(a[e])+1,c+=i[l.split("!!")[1]]+";")})}),t.each(n.MinFields,function(t,e){s.a.isEmpty(i[e])&&(0==a[e]?a[e]=i[e]:a[e]>i[e]&&(a[e]=i[e]))}),t.each(n.MaxFields,function(t,e){s.a.isEmpty(i[e])&&(0==a[e]?a[e]=i[e]:a[e]>i[e]&&(a[e]=i[e]))}),t.each(n.AverageFields,function(e,l){s.a.isEmpty(a[e])&&0==a[e]&&(a[e]={sum:0,count:0}),s.a.isEmpty(i[l])&&(a[e].sum=parseInt(a[e].sum)+parseInt(i[l])),s.a.isEmpty(n.objSetting["R"+o])&&t.each(n.objSetting["R"+o].split(";"),function(t,n){s.a.isEmpty(i[l])&&n==e&&(a[e].count=parseInt(a[e].count)+1)})})});if(s.a.isEmpty(n.objSetting.ExtraFields)){var l=n.objSetting.ExtraFields.split("|"),c=s.a.stringToObject(n.objSetting.ExtraValue.replaceAll("+","&").replaceAll(":","="));if(t.each(c,function(e,i){if(e==a[l[0]]){var o=i.split("|");a[l[0]]=o[0],a[l[1]]=o[1]}else if(s.a.isEmpty(n.objSetting.ExtraRequest)){a[l[0]]=0,a[l[1]]=0;var c=0;t.each(n["Data"+n.objSetting.ExtraRequest],function(t,e){s.a.isEmpty(e[n.objSetting.ExtraCondition])&&(c=parseInt(c)+1)});var r=s.a.stringToObject(n.objSetting.ExtraValueAfter.replaceAll("+","&").replaceAll(":","="));if(t.each(r,function(t,e){if(t==c){var s=e.split("|");a[l[0]]=s[0],a[l[1]]=s[1]}}),s.a.isEmpty(r.ELSE)&&0==a[l[1]]){var u=r.ELSE.split("|");a[l[0]]=u[0],a[l[1]]=u[1]}}}),s.a.isEmpty(c.ELSE)&&0==a[l[1]]){var r=c.ELSE.split("|");a[l[0]]=r[0],a[l[1]]=r[1]}}var u={};t.each(a,function(t,e){s.a.isEmpty(e,"sum")&&s.a.isEmpty(e,"count")&&(e=e.sum/e.count),u[t]=e}),t.each(n.ExpressionFields,function(t,e){for(var a=e,n="";""!=a;){if(a.indexOf("{{")>=0&&a.indexOf("}}")>a.indexOf("{{")){n+=a.substr(0,a.indexOf("{{"));var o=a.substr(a.indexOf("{{")+2,a.indexOf("}}")-a.indexOf("{{")-2),l=i.$Lodash.cloneDeep(o);o.indexOf(".")>0&&(l=o.substr(0,o.indexOf(".")).trim(),o.substr(o.indexOf(".")+1,o.length).trim());for(var c=!1,r=0;r<u.length;r++)t==l&&(s.a.isEmpty(u[r])&&(n+=u[r]),c=!0);c||s.a.isEmpty(u,l)&&(n+=u[l],c=!0),c||(n+=0),a=a.substr(a.indexOf("}}")+2,a.length)}else n+=a,a="";u[t]=0,""!==n&&""==a&&(n=n.replaceAll(".DIVIDES","(").replaceAll(".DIVIDEE",")"),u[t]=s.a.calculator(n))}}),u.RequestTemplate=n.objSetting.RRequestTemplate+".Update",u.RequestDataGroup=n.objSetting.RRequestDataGroup,u.RequestFields=n.objSetting.RRequestFields,n.ListExcuteRequests.push(u),n.mathIndex<n.rootLength-1?n.mathIndex++:(s.a.showLoading("stop"),s.a.showMessage("success","Tính toán thành công!"),n.IsExcute=!0)})},excuteUpdate:function(){ctrl.listLogs={Success:0,Failed:0,Message:"",Updated:0},createUpdateRequest()},createUpdateRequest:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=!1,e=this.$Lodash.cloneDeep(this.$singleRequest);e.TotalRequests=0;for(var a=ctrl.Index,i=0;i<ctrl.Increased&&a+i<ctrl.ListExcuteRequests.length;i++)ctrl.Index=a+i,e.TotalRequests++,e=s.a.updateParamsSingleRequest(e,ctrl.ListExcuteRequests[ctrl.Index],e.TotalRequests);s.a.post(e).then(function(e){e.success&&(1==e.success?ctrl.listLogs.Updated=ctrl.listLogs.Updated+ctrl.Increased:ctrl.listLogs.Failed=ctrl.listLogs.Failed+ctrl.Increased,ctrl.Index==ctrl.ListExcuteRequests.length-1?t=!0:ctrl.Index++,t?(ctrl.Index=0,ctrl.listLogs.Success=ctrl.ListExcuteRequests.length,s.a.showMessage("success","Cập nhật thành công!")):(ctrl.listLogs.Success=ctrl.listLogs.Success+ctrl.Increased,createUpdateRequest()))})}),init:function(){var t=this;t.ListExcuteRequests=[],t.SumFields={},t.CountFields={},t.Index=0,t.Increased=100;var e=this.$Lodash.cloneDeep(this.$singleRequest);e.R1_RequestTemplate="Setting.SearchBase",e.R1_ParentCode="xSetting.Project.Calculator",s.a.post(e).then(function(e){t.comboCalculator=s.a.getDataWithRoot(e.R1,"Data.DynamicDS.Setting")})}}}}).call(e,a(2))},1125:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{attrs:{"label-width":"130px"}},[a("el-form-item",{attrs:{label:"Chọn công thức"}},[a("el-select",{attrs:{placeholder:"Chọn"},model:{value:t.Calculator,callback:function(e){t.Calculator=e},expression:"Calculator"}},t._l(t.comboCalculator,function(t){return a("el-option",{key:t.Id,attrs:{label:t.Name,value:t.Code}})}))],1),t._v(" "),t.Calculator?a("el-button",{on:{click:function(e){t.Calculate()}}},[t._v("Tính toán")]):t._e(),t._v(" "),t.IsExcute?a("el-button",{on:{click:function(e){t.excuteUpdate()}}},[t._v("Cập nhật")]):t._e()],1)},i=[],n={render:s,staticRenderFns:i};e.a=n},914:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(1124),i=a(1125),n=a(0),o=n(s.a,i.a,!1,null,null,null);e.default=o.exports}});
//# sourceMappingURL=26.b75def2074cb2a9ccd18.js.map